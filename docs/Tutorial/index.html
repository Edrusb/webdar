<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <link href="../style.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Webdar Tutorial</title>
  </head>
  <body>
    <img src="../webdar_logo.jpg" class="flr"/>
    <h1>Webdar Tutorial</h1>
    <p>
      Webdar version: 1.0.x
      <br/>
      Document revision: 2
      <br/>
      Author: Denis Corbin
    </p>
    <div class=menutop></div>
    <h2>Table of Content</h2>

    <ul>
      <a href="#h2A"><li>Running and connecting to Webdar</li></a>
      <a href="#h2B"><li>Web Authentication to Webdar</li></a>
      <a href="#h2C"><li>Using Webdar with its default options</li></a>
      <ul>
	<li>Multi-sessions</li>
	<li>Backup operations</li>
	<li>Testing operation</li>
	<li>Comparing a backup with the file-system</li>
	<li>Backup listing</li>
      </ul>
      <a href="#h2D"><li>Using Webdar and its Options</li></a>
      <ul>
	<li>Setting up on-fly options</li>
	<li>Setting up named configurations</li>
      </ul>
      <a href="#h2E"><li>Advanced features</li></a>
      <ul>
	<li>Remote repository</li>
	<li>min-digits option</li>
	<li>Illustration with restoration operation</li>
	<li>Using the <em>in-place path</em></li>
	<li>Restoring only some file</li>
      </ul>
      <a href="#h2F"><li>Network and Application security</li></a>
      <ul>
	<li>Browser - Webdar communication</li>
	<li>Webdar - SFTP server communication</li>
      </ul>
    </ul>

    <a id="h2A"><h2>Running and connecting to Webdar</h2></a>

    <p>
      To use Webdar version 1.0.0 you need to run it from a shell, that's to say a
      terminal (virtual terminal, xterm, Kconsole, ssh session or
      equivalent). It is not necessary to be root (no need of
      <code>sudo</code>,
      <code>su</code> nor login as root) to run Webdar, if for example you
      want to backup your <em>Home</em> directory, which is what we will
      do in this tutorial. Let's rock:
    </p>
    <code class=block>
 > ./webdar
[thead 140511479814720][warning]

        You can now point your browser at:
                http://127.0.0.1:8008
        and use the following to authenticate:
                user name = admin
                password  = &lt;a random string&gt;


[thead 140511470872256][information]   listener object: waiting for incoming connections on 127.0.0.1 port 8008
    </code>


    <p>
      The host were you run Webdar is the place where is located the
      data to backup or to restore. We will see a bit further that
      this is not necessarily the place where the backup will be
      stored. By default and for security reasons, only a browser
      of the same host can connect to Webdar using URL displayed
      in the output (<code>http://127.0.0.1:8008</code>)
    </p>

    <p>
      For the browser to reside on another host than the one where
      Webdar is running, you must use its <code>-l</code> option to specify the IP
      interface(s) of the node where Webdar is running (either IPv4 or IPv6 or FQDN).
      This will lead Webdar to listen on theses network interfaces
      for incoming connections. You can also use the wildcard <code>0.0.0.0</code>
      or its equivalent <code>[::1]</code> in IPv6 and Webdar will listen for connection
      of all network interfaces the node has (note that IPv6 address should be
      enclosed in quotes to avoid the shell interpreting them as a glob expression)
    </p>

    <p>
      Here on my host, according to the output of <code>ifconfig</code> command (or
      the Linux specific equivalent <code>ip a</code> command) we can see the node
      has an interface <code>eth0</code> assigned to the IPv4 address
      <code>192.168.6.6</code>:
    </p>

    <code class=block>
 > ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9000
        inet <e>192.168.6.6</e>  netmask 255.255.255.128  broadcast 192.168.6.127
        ether XX:XX:XX:XX:XX:XX  txqueuelen 1000  (Ethernet)
        RX packets 21719187  bytes 103747456345 (96.6 GiB)
        RX errors 0  dropped 1647533  overruns 0  frame 0
        TX packets 13757737  bytes 7120233504 (6.6 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Boucle locale)
        RX packets 189129  bytes 200891331 (191.5 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 189129  bytes 200891331 (191.5 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
    </code>

    <p>
      Thus we instruct Webdar to listen on this interface only. Connecting to 127.0.0.1,
      the loopback address, will now fail, but we could use instead the wildcard address 0.0.0.0
      or specify more IP addresses separating them by comas to have Webdar listening to more
      than one interface at a time.
    </p>

    <code class=block>
 > webdar -l 192.168.6.6
[thead 139698648119872][warning]

        You can now point your browser at:
                http://192.168.6.6:8008
        and use the following to authenticate:
                user name = admin
                password = &lt;a random string&gt;

[thead 139698639177408][information]   listener object: waiting for incoming connections on 192.168.6.6 port 8008
    </code>

    <p>
      Then we give to our browser, possibly running on a remote host having
      access to this node where Webdar is now runing,
      the provided URL  (<code>http://192.168.6.6:8008</code>).
    </p>

    <a id="h2B"><h2>Web Authentication to Webdar</h2></a>

    <p>
      Webdar's command-line output displayed the login and password
      to provide on the browser to authenticate. If you added <code>-v</code> option to see
      more logs, you may end up having this dynamically generated password
      out of the screen, just hit CTRL-C (<u>but no more than once per 2 seconds</u>)
      and it will show again!
    </p>

    <img src="6bff08378357a44.png"/>

    <a id="h2C"><h2>Using Webdar with its default options</h2></a>

    <p>
      <i><b>Webdar</b></i> is a web front-end to the <i><b>libdar</b></i>
      library. You will see libdar mentioned at diverse place, consider
      this part of Webdar and equivalent to it.
    </p>

    <h3>Multi-sessions</h3>

    <img src="e494ee17e4425004.png"/>

    <p>
      Congratulations! You have reached the main page of Webdar!
    </p>
    <p>
      In this page, you can see on the left a vertical menu with the available
      operations (create, test,..., restore) followed by the <em>configure</em>
      menu where we will be able to store common or reusable parts of the
      configurations. Finally, yet below the menu <em>Other sessions</em>
      we will see now.
    </p>

    <p>
      Webdar is ready to be multi-user but today only the <em>admin</em>
      user is available, though this user can have several sessions that
      can run in parallel. Note that the <em>admin</em> user is nothing
      related to a Unix account, it is just a placeholder in Webdar for a
      future user based feature. Webdar acts as the user and group it has
      been run as and has thus access only to files this user and group has
      access to.
    </p>

    <p>
      The session name seen above is show at the bottom of the screen as
      <code>MirL</code>
    </p>

    <img src="f0026e2e0ca3d19c.png">

    <p>
      This is a randomly chosen string which you can change. You then
      need to validate the change with the <code>Change</code> button:
    </p>

    <img src="6a050fb80009f58f.png"/>

    <p>
      This will always be that way: Webdar does not make use of scripts
      <u>by design</u>. The counterpart is that you know what information you
      send to Webdar and when you send it, nothing 'runs' from Webdar on
      the host where is located your browser (unless, of course, when this is also the host
      were Webdar is running). I let you click the <code>Mini Tuto</code>
      button on the bottom right and check out what all this means concretely.
    </p>

    <center>
      <img src="edde4bbb97788c52.gif"/>
    </center>

    <p>
      Back from the <code>Mini Tuto</code> let's now click the
      <code>Other sessions</code> Button on the left:
    </p>

    <center>
      <img src="9243b5b59822b98c.png"/>
    </center>

    <p>
      You see here the list of existing sessions. From here you can
      create new ones and delete old ones. This is for now a door ready for
      future features, like a scheduler (task queuing) and maybe inter-user
      visibility.  But let's go back to the session &quot;My first
      session&quot; we just renamed under that name, by clicking to its
      name:
    </p>

    <img src="211e210d40707743.png">


    <h3>Backup operations</h3>

    <p>
      Back to the session let's create our first backup! Select "Create" in the menu on the left:
    </p>

    <img src="2fd9fdea05eb9b83.png"/>

    <p>
      The page now shows three parameters:
    </p>

    <dl>
      <dt>What directory to backup</dt><dd>
	It defaults to your home directory,
	but can be anything. You can navigate the directory tree clicking
	the '+' button on the right
      </dd>
      <dt>Where do we want to put the backup</dt><dd>
	Obviously the root of the
	directory '/' is not a good place! We must change that. Let's use an
	USB key to store our backup. We must set this second field to the
	location where your system will or has mounted it. We will see later
	how to use remote FTP or SFTP repositories instead of the local
	file-system.
      </dd>
      <dt>The file name under which Webdar will store your backup</dt><dd>
	Most of the time a backup results in a single file but
	you can also decide it to be many files of a given size (to span you
	backup over several USB keys, DVDs or several files in the public
	cloud). Whatever is the number of files they will all start by this
	<em>basename</em> and only have here to give this information.
      </dd>
    </dl>

    <p>
      Here for the exercise we will mount an USB key and set the second
      parameter to the place where the system has mounted it and use
      <code>full1</code> as the basename of our backup. Don't forget to
      validate your change by clicking the <code>update</code> button:
    </p>

    <center>
      <img src="f28598aa78895a0f.png">
    </center>

    <p/>

    <img src="5e5675b8e4b8791b.png">

    <p>
      OK, we are now ready to proceed, let's press the <code>Create</code>
      button on the bottom right of the screen:
    </p>
    <img src="efc95d09b728fc42.png">

    <p>
      By default all backups are strongly ciphered. This is why Webdar
      asks you a password or passphrase to remember, to be to able later to
      decipher and read the backup. Ciphering can be disabled or be based
      on public/private key pair, we will have a look at the many options
      available with Webdar in the next chapter, for now, let's do it
      simple and secured: enter a password.
    </p>

    <p>
      Note that once the password has been entered, you need to click
      the <code>update</code> button left below
      (not the <code>Gracefully stop libdar</code> one!). Webdar will
      ask you to confirm the password and then proceed to the
      backup operation if the two passwords match.
    </p>

    <p>
      Depending on the amount of data and the speed of your disks (and
      here mainly the speed of the USB key), it may takes a few seconds to
      several minutes... for the backup to complete.
    </p>

    <p>
      OK, once finished, the counters do not move anymore and the button
      to interrupt the backup has been replaced by a <code>Close</code>
      button:
    </p>

    <img src="2163f5af3fc3822.png">

    <p>
      you can close this output and get back to Webdar main page
    </p>

    <p>
      Let's have a look at the content of your USB key.
      This is what you should see:
    </p>

    <ul>
      <li>
	a file named <code>full1.001.dar</code>
      </li>
      <li>
	a file named <code>full1.001.dar.whirlpool</code>
      </li>
    </ul>

    <p>
      The first <u>is</u> the backup in totality. The second is a
      hash file, that let you quickly check that the backup file
      on disk is not victim of corruption during the write process.
    </p>
    <p>
      You can check this hash <i>---here using the whirlpool algorithm---</i>
      using the <code>rhash</code> command, and you would use
      <code>md5sum -c</code> for a md5 hash, <code>sha1sum -c</code> for a
      sha1 hash or <code>sha512sum -c</code> for a sha512 hash, which are
      other possible hash algorithms available with Webdar.
    </p>

    <p>
      But before proceeding, let's eject and reinsert the
      USB key to flush all data from the cache, here below this is snapshot
      of a KDE desktop environment, but other desktops have a similar
      feature (you could also use mount/umount on command-line):
    </p>

    <center>
      <img src="aa68bca73838db14.png"/>
    </center>


    <p>
      Once the USB key is back mounted we can check the backup hash, as shown here
      below using the command-line:
    </p>
    <code class=block>
 &gt; cd /media/denis/USBKEY/
 &gt; rhash -c -W full1.001.dar.whirlpool
--( Verifying full1.001.dar.whirlpool )-----------------------------------------
full1.001.dar                                              OK
--------------------------------------------------------------------------------
Everything OK
    </code>

    <p>
      You can then remove the whirlpool file or keep it beside your
      backup, if you want to test the stability of the medium over time.
      Note that a hash does not let you repair a file, for that I would
      advise using
      <a href="https://parchive.github.io/">Parchive</a> a very useful program,
      especially for sensible medium like DVD and USB keys. <em>Parchive</em> will
      let you add parity data beside the backup files to be able to repair
      them in case of storage corruption, which can take place over time...
    </p>

    <p>
      The next step you should always perform is a backup test operation!
      This operation will checking that all data is readable and well
      formatted in your backup. It does not restore anything nor it modifies
      the backup, but can detect things that could prevent you from relying
      on your backup when you would need them the most...
    </p>

    <h3>Testing operation</h3>

    <p>
      This step is necessary to be sure you will be able to restore
      later, as there are many reasons that may lead a backup to be
      unusable, even if Webdar will report most of the errors conditions:
    </p>

    <ul>
      <li>
	Disk write corruption: with the hash check we did previously
	we should have this already checked
      </li>
      <li>
	Disk saturation: how many dar/libdar users asked about what
	to do with their truncated backup due to disk saturation, something
	they noticed only too late, when they needed to restore data from
	it... Hopefully you can now isolate/repair such backup to avoid
	having to remake the backup.
      </li>
      <li>
	Memory corruption: due to the famous <em>cosmic particle</em>
	that explains so many unknown reasons...
      </li>
      <li>
	Software bug: yes, no software has no bug, even if Webdar and
	its engine <i>libdar</i> have been heavily tested. Libdar
	benefits in addition from a long history --- two decades ---
	and return on experience, but...
      </li>
      <li>
	Human error, like not running the operation or passing a
	wrong parameter that drops the backups somewhere you will not find
	it, lack to include some files in your backup...
      </li>
    </ul>

    <p>
      So let's select the &quot;Test&quot; operation on the left:
    </p>

    <img src="632ee8e132d8a820.png"/>

    <p>
      We have to set the correct path to the backup, either by typing the path
      and basename in the <em>Backup Path</em> field (and then clicking
      the <code>update</code> button below) <b>or better</b>: by navigating the
      directory tree clicking the '+' button on the right:
    </p>
    <center>
      <img src="65837b4ada646047.gif"/>
    </center>

    <p>
      This has the advantage to transparently set the <em>min-digits</em>
      options we will explain in a second.
    </p>


    <img src="61bacc939c23822a.png"/>

    <p>
      Once in the correct directory (the path where is mounted the USB key), we
      see listed the backup we were looking for, so we click on its name to select it.
    </p>

    <img src="62d182518e476387.gif"/>

    <p>
      Note that the content of the <em>Backup Path</em> field has been
      filled, but it does not hold the full path+filename: only what is
      called the <b>basename</b> we used at backup creation time (<code>full1</code>) is present:
    </p>

    <dl>
      <dt>Slices:</dt><dd>
	<p>
	  A backup can be split in several files called
	  <b>slices</b>. Each is a file which name starts by the <em>basename</em>
	  and is followed by a number followed bye the <em>dar</em> extension with a dot
	  as separator. Their number starts at 1 increasing virtually without limit:
	</p>
	<ul>
	  <li>full1.001.dar</li>
	  <li>full1.002.dar</li>
	  <li>full1.003.dar</li>
	  <li>...</li>
	</ul>
	<p>
	  But even when using a single sliced backup as here we still have a file
	  following the slice format, and what we need here is
	  the <em>basename</em> part only.
	</p>
	<p>
	  Now, if a backup is a set of slices or a single slice as here, you
	  cannot do much with a slice alone, unless you are lucky and all
	  data you need for a restoration is found in that slice. Even
	  if not all slices are needed for a given restoration, you must not
	  consider slices individually but keep considering a backup as the
	  set of slices as the object Webdar is manipulating: You will never
	  provide a slice name to Webdar but a <em>basename</em>.
	</p>
      </dd>
      <dt>min-digits</dt><dd>
	<p>
	  As mentioned before, the min-digits is the number of digits the
	  slice number (here 001) is stored. Hence here we have a min-digits
	  set to 3. Using the '+' button instead of filling manually the
	  path+basename, Webdar has set this parameter for us by reading the
	  the structure of the slice name. If you decided to fill the path
	  manually you would have to set this parameter correctly in the
	  <em>Read Options</em>, something we will see at the end of this
	</p>
      </dd>
    </dl>

    <p>
      Anyway, we can now run the test by clicking on the <code>Test</code> Button located on the right:
    </p>

    <center>
      <img src="7cb934e930a25411.png"/>
    </center>

    <img src="2476c177983ebd41.png"/>

    <p>
      Yes, we have to give the password we have set on the backup
      to be able to decipher the backup and read its content...
    </p>


    <img src="b91046e47c9c469c.png"/>

    <p>
      At the end of the process, you see the <code>Close</code> button on
      the bottom right, but before closing this page we can check before
      that the counters do not report any error. This is the case here, so the
      backup testing is successful.
    </p>

    <p>
      You may have noted that the paths of the files in the backup do
      not contain the <code>/home/denis</code> part they have on the file-system.
      This is because at backup time we have restricted the backup to with
      this path as <em>root</em> of the backup (remember the first of the
      three backup parameters we set?).
    </p>
    <p>
      Hopefully it is possible to do else in order to have the full path of
      files though not saving the whole file-system! We will see that when
      we will play with <em>Path Filters</em> below.
    </p>

    <h3>Comparing a backup with the file-system</h3>

    <p>
      This is one step further the backup testing: not only here we read
      the backup content, but we compare it with the file-system. Of course
      if your file-system has changed since the backup was done, you will see
      differences reported.
    </p>

    <img src="588f9fbbd33e799.png"/>

    <p>
      In terms of use, this operation is very similar with the testing
      operations, there is just an additional parameter to set, which is
      the path of the file-system to compare with. I let you play alone with
      this option, as there is no difficulty here.
    </p>

    <h3>Backup listing</h3>

    <p>
      Who does not want to know what's in a backup?
    </p>

    <p>
      Easy! just click the <code>List</code> menu on the left,
    </p>

    <img src="ca9011ad7cc17416.gif"/>

    <p>
      The backup to read should already be set, taken from the <code>Test</code>
      and <code>Compare</code> operations we just performed. The other parameter
      is just set for what we need: <code>display backup contents</code>. We keep
      the <code>Read Options</code> to their default for now so we just to click
      on the <code>List</code> button located on the right...
    </p>

    <img src="edd9cdbd2346dd.png"/>

    <p>
      Note that the root of the file-system is always <code>ROOT</code> inside
      a backup. It is substituted by the parameter you give for file-system related
      operations, like during the comparison we have just played with.
      Same thing at restoration time, you will be asked to provide a path where
      to restore the data. But you could also use the <b>in-place path</b>
      stored in the backup. This <em>in-place</em> path is
      the path that was used as file-system root at backup time,
      (<code>/home/denis</code> in our case), it is stored in the backup.
    </p>
    <p>
      Let's close this window and check the value of the <em>in-place</em> path.
      For that we just have to change the <em>Listing Parameter</em> as show here:
    </p>

    <img src="354ac89a4e508c6d.png"/>

    <p>
      Then click the <code>List</code> button on the right:
    </p>

    <img src="1489fa46c2045ed5.png"/>

    <p>
      You can see the <em>in-place path</em> value as the last entry of the first
      table. Also check out the other parameters for your curiosity or
      information.
    </p>

    <a id="h2D"><h2>Using Webdar and its Options</h2></a>

    <p>
      So far we have been using defaults options for all parameters.
      These are selected for the best security and most common usage for
      the backup of a personal computer. But they can be changed easily,
      either <b>on-fly</b> for an single operation or recorded under
      a <b>name</b> for long term and reuse, by mean of the <code>Configure</code>
      menu on the left. This chapter has this objective to explain how to
      use options in these two ways.
    </p>

    <h3>Setting up on-fly options</h3>

    <p>
      Let's revisit the backup we did to see how to store the same data (our
      home directory), but having the path including the <em>/home/denis</em> part.
      First replace <code>/home/denis</code> we had set as <em>root of the filesystem to backup</em>
      (first parameter) by <code>/</code> and click the <code>update</code>
      button below to validate the change:
    </p>

    <img src="9be1c8f341c98007.png"/>

    <p>
      We now have to tell Webdar to not save everything under <code>/</code>, but
      only what's located in the <code>/home/denis</code> directory. For that,
      Let's click on the <code>Creation options</code> bar:
    </p>

    <img src="ede84aa8e461cbd9.png"/>

    <p>
      We see this option to be set to from a configuration named <code>default</code>.
      This is a predefined configuration we will <code>Edit</code>(button on
      the right). Editing this way a configuration does not modify it, but
      creates unnamed and so-called <em>on-fly</em> copy of it. We can still
      save such <em>on-fly</em> under a name but it will be a new configuration
      with a new name. So no worries you won't break anything! Click the <code>Edit</code>
      button on the right:
    </p>

    <img src="6d2169e36c37b95e.png"/>

    <p>
      Note first that the name <code>default</code> has been replaced by
      <code>---- manual config ----</code> which is a synonym of <em>on-fly configuration</em>.
      We are thus currently editing a new configuration that
      has no name but is a copy of the named configuration we edited. Such
      <em>on-fly</em> configuration can be used without being saved under a name. It will
      stay available at this place while Webdar is running, but will be lost
      if you stop or restart it.
    </p>

    <p>
      Now, what we are looking for our backup configuration is the
      <code>Path based filtering</code> bar. Click on it to open this part
      of the configuration:
    </p>

    <img src="f9c4a8277057908a.png"/>

    <p>
      <b>Pay attention!</b> We are in front of a nested on-fly configuration!
      The whole part under the <code>Path based filtering</code> is also an
      on-fly configuration (see the <code>---- manual config ----</code> showing at
      the top of that section).
    </p>
    <p>
      OK, back to our objective, let's <code>Add a new mask</code> selecting a <code>Path expression</code> mask:
    </p>

    <img src="8b4e50f8be2f536.png">

    <p>
      For the sake of completeness, the available options are for:
    </p>
    <dl>
      <dt>Path expression</dt><dd>
	Select files which path+filename match a glob or a regular expression
      </dd>
      <dt>File listing</dt><dd>
	Select files which path+filename are listed in a given file,
      </dd>
      <dt>Logical combination</dt><dd>
	Making a AND/OR combination of different masks. Note that we are
	already in a *AND*ed combining component here.
      </dd>
      <dt>Recorded configuration</dt><dd>
	Use an existing named path filter configuration. This way you can
	combine several named configuration and/or amend them with customized
	on-fly configuration.
      </dd>
    </dl>

    <p>
      But let's zoom on the path expression for now. You need first to click
      the <code>update</code> button as usually in Webdar for changes to fly to Webdar:
    </p>

    <img src="path_filter_expression.jpg"/>

    <p>
      We can now fill the <code>Concerned path</code> with <code>/home/denis</code>.
      but for flexibility and reuse in other context, better
      always using a relative path <code>home/denis</code>. This path will be prepend
      by path of the filesystem root we have chosen for the backup creation
      operation (here we chose <code>/</code>). The other parameters are left
      as is (<code>Mask Type</code> and <code>Case Sensitive</code>), so we can
      click again the <code>update</code>  button and see in bold how the mask
      now displays what it does: a file will be
      <code>involved if... [its] path is or is a subdir of /home/denis (case sensitive)</code>:
    </p>

    <img src="7116525331cf6a09.png"/>

    <p>
      Let's go back to the backup parameters and change the backup name to <code>full2</code>
      then click the <code>update</code> button:
    </p>

    <img src="ac04fa3943adacbd.png"/>

    <p>
      Then just run the backup creation process by clicking the <code>Create</code>
      button:
    </p>

    <center>
      <img src="7ade4ec301f1f33a.png"/>
    </center>

    <p>
      As seen previously we will get a new single sliced backup having for
      slice named <code>full2.001.dar</code>.
      Now check that the content contains as expected the full path,
      using either the <code>Test</code> operation or as show below using
      the <code>List</code> operation:
    </p>

    <img src="with_path_from_root.jpg"/>

    <p>
      Now let's get back to our on-fly configuration in the <code>Path based Filtering</code>.
      We will save it under the name <code>my home dir</code> so we will be able to reuse it
      later and keep it available across Webdar restarts:
    </p>

    <img src="8f842020390963d2.png"/>

    <p>
      Then click the <code>Save as</code> button to proceed:
    </p>

    <img src="7e2926107bf2b406.png"/>


    <p>
      You now see that the whole configuration has been replaced by
      the <code>my home dir</code> label in the drop down list. We have
      made a <em>named</em> configuration from an <em>on-fly</em> one.
    </p>
    <p>
      You can still <code>Edit</code>
      it, but it will become a new on-fly configuration. You can also
      select the <code>Manuel config</code> menu to start from scratch a new
      configuration on the right, this has the same effect as clicking the <code>Clear</code>
      button when editing an on-fly configuration.
    </p>
    <p>
      But if you want to modify this <b>named</b> <code>my home dir</code>
      configuration, we have to go to the <code>Configuration</code> Menu.
      This is the topic of the next chapter.
    </p>

    <h3>Setting up named configurations</h3>

    <p>
      So we select the <code>Configure</code> Menu on the left:
    </p>

    <img src="9915c7a79f8706b6.gif"/>

    <p>
      OK, this page is a quite rich, I admit. It contains a second level
      made of <b>tabs</b> displayed on the top of the page, located beside
      the left handed menu.
    </p>
    <p>
      We will get back later to this <code>Global Settings</code> tab, currently
      selected, it drives how and when all options found in all other tabs are saved.
    </p>
    <p>
      As you see, each other tab materialize the different configuration
      <b>categories</b> available in Webdar. Each category has its own name space,
      so you may have two configurations of same name if they are in different tabs.
      The first category tab, is the <code>Repository Options</code> we will look at in detail for FTP
      and SFTP remote storage further in this tutorial.
    </p>
    <p>
      For now, we just want to modify the <code>Path filters</code> we created, thus
      select that tab:
    </p>

    <img src="a2ffa717d0713160.gif"/>

    <p>
      In the middle of the page, you see the same configuration
      structure we had found under the <code>Path Base Filtering</code> of the
      <code>Create Options</code>. On the right, you see a radio button list
      with only one choice for now: it contains <code>my home dir</code>
      configuration we created from an <em>on-fly</em> configuration. Let's
      select this option, then click the <code>Load selected</code> button
      just below:
    </p>

    <img src="a3b16caea66082bc.gif"/>

    <p>
      Now you see loaded the configuration we did. Also note that the
      <code>&lt;ROOT&gt;</code> appeared in place of the <code>/</code> we had,
      in the bold description of what the mask does.
      This will be substituted at operation time and gives you more flexibility
      to reuse this path filter configuration than having set an absolute
      path in place of <code>home/denis</code>.
    </p>

    <p>
      Note also, at the bottom of the page the box with the configuration name
      and the <code>Save/Save as</code> button.
    </p>

    <p>
      So we can modify the form, add other mask and update the form
      with the <code>update</code> button when needed. In the snapshot below
      we have changed the logic from <code>AND</code> to <code>OR</code> and
      added another path expression to include an external mounted disk in
      the backup:
    </p>

    <img src="f56f6018582c8ea7.gif"/>

    <p>
      At this stage (assuming you have clicked the <code>update</code>
      button) the configuration is not only in your browser but also now known
      by Webdar, however it is not save and the <code>my home dir</code>
      configuration is still the same. Below in red you see the warning
      <code>Configuration not saved</code>. To save it and have it replacing the old
      definition, click the <code>Save/Save as</code>
      button and see the red warning vanishing.
    </p>

    <p>
      This will update the configuration at every place where it has
      been used. For example, we can go back to the <code>Create</code>
      menu, go down to the <code>Path base Filtering</code> options and
      if <code>my home dir</code> is still selected click the <code>Edit</code>
      button and see the new definition showing.
    </p>
    <p>
      Now, if you remember well, I warned you about nested configuration: we
      were opening the <code>Create Options</code> and clicked on the Edit button while
      the selected configuration was set to <code>default</code>. This <code>default</code>
      configuration is of category <code>Create Options</code> let's select
      this tab in the Configure page:
    </p>

    <img src="98427a2f100e0fca.gif"/>

    <p>
      As we did before, select on the right the radio button <code>default</code>
      and click the <code>Load selected</code> button right below.
    </p>

    <p>
      What we will do now is to change the default configuration for
      backup creation, in order for our filter <code>my home dir</code> to be set
      automatically in the future (even if you stop and restart Webdar).
    </p>
    <p>
      Once the <code>default</code> configuration is loaded, edit the
      <code>Path base filtering</code> options and select
      the <code>my home dir</code> sub-configuration:
    </p>

    <img src="4b31ba5399b6c196.gif"/>

    <p>
      Once set, don't forget to save this new definition of the <code>default</code>
      configuration by clicking the <code>Save/Save as</code> button at the
      bottom for the red warning vanishes:
    </p>

    <img src="6cbe5fe11f57687d.gif"/>

    <p>
      You may be alarmed about the fact we have changed a default
      configuration, while we should have better saved it under another name
      just replacing the name <code>default</code> by something else before clicking
      the <code>Save/Save as</code> button. No worries let's go to the
      <code>Global settings</code> tab...
    </p>

    <img src="5c0f74d5ed4bffd3.gif"/>

    <p>
      ...and scroll down the page to its bottom:
    </p>

    <img src="bc43b682eefa37b4.gif"/>

    <p>
      See the large button <code>Regenerate missing defaults configs</code> button?
    </p>
    <p>
      We can click on it right now, it will not reset the
      <code>default</code> configuration for the <code>Creation Options</code>
      we modified, because no configuration of that name in that category is <em>missing</em>.

      But you guessed, if we save it under another name, then load and delete the
      <code>default</code> one, clicking on this button will then regenerate this
      missing <code>default</code> configuration. So we will have back the original
      <code>default</code> and the one we have changed under a non-default name:
    </p>

    <img src="2ea0c716a91d7938.gif"/>

    <p>
      The advantage of modifying the <code>default</code> configuration
      is that each time you restart Webdar, you will have all set for
      your particular context, like filters (Path Based, but also Named based),
      log level options up to the Remote repositories we will see next.
      That way, you just can forget the options and focus on the operations
      parameter most of the time.
    </p>
    <p>
      In this global page, you should have see that the content of all
      tabs of the configure page is saved in the $HOME/.webdarrc file. You
      can save the whole configuration sets to another file, and load
      another file at will and have several sets of such configurations.
    </p>
    <p>
      You can also upload and download the same configuration through
      the web session from your Web browser. But <b>pay attention</b> when
      not using secured connection (SFTP with validated certificate):
      Any password you would have saved in an configuration, like a password
      for ciphering or deciphering a backup, but also credentials for
      authentication to remote FTP or SFTP repository, will be contained in
      the configuration, and exposed to attackers that could have access to the
      network or nodes through which this session passes.
    </p>

    <a id="h2E"><h2>Advanced features</h2></a>
    <p>
      We skipped over the <em>Isolate</em>, <em>Merge</em> and <em>Repair</em>
      operations because the first two are advances topics and you should
      not need them often, while the third --- if you test your backups right
      after backing them up --- should not be needed to you, though the repairing
      operation is quite simple
    </p>

    <p>
      The <code>Restore</code> operation is also simple, as simple as the
      <code>Create</code> one we saw at the beginning. Let's leverage
      this simplicity to see how to store backup on a remote server.
    </p>

    <p>
      We will replace our USB key by an SFTP server. Let's go to the
      <code>Repository Options</code> tab of the <code>Configure</code> Menu
      to instruct Webdar where to drop and fetch the backups:
    </p>

    <h3>Remote repository</h3>

    <img src="f90814f253cf9ece.gif"/>

    <p>
      First, let's have a look at the default configuration: Select the <code>default</code>
      radio button on the right and click the <code>Load selected</code> button.
      You should see almost the same page as the cleared one that was showed
      initially (compare with the snapshot above):
    </p>

    <img src="8f23e27520776f79.gif"/>

    <p>
      The differences are:
    </p>

    <ul>
      <li>
	Obviously, this is now the <code>default</code> configuration that is
	selected, any change we do and save will replace the named default
	repository configuration, which is used in all operations (create,
	test, compare, ...), unless you change it there.
      </li>
      <li>
	The <b>landing path</b> is set to <code>/tmp</code>
      </li>
      <li>
	and the checkbox above the <em>landing path</em> field it is checked.
      </li>
    </ul>

    <p>
      For our initial backup, we could have replaced the <em>landing path</em>
      of the default repository configuration by <code>/media/Denis/USBKEY</code>.
      Doing that way, anytime we do a new backup,
      the path to store the backup would have be already be set. This would have
      been pretty convenient, right?
    </p>

    <p>
      About the checkbox now: If some backup path and basename is already filled for an
      operation and you change of repository, the landing path will not
      replace the content unless you check the box.
    </p>

    <p>
      OK, we can change the <code>default</code> configuration of
      <code>Repository Options</code> category to point to a SFTP server,
      this will have impact for all operations <code>default</code> configuration,
      this is what we have done
      for the <code>Path Filtering</code> of the create option. But let's do something
      different this time: First click the <code>Clear</code> button located on the right:
    </p>

    <img src="517106af636877a7.gif"/>

    <p>
      The <code>default</code> configuration has not been modified and
      the form that now shows has been cleared to its default.
    </p>

    <p>
      Suppose we have access to <code>/dar-check/Backups</code> directory on an
      remote SFTP server, so we setup the landing path accordingly, we will
      also check the box above and change the repository type to SFTP. To
      validate these three changes we click on the <code>Apply Changes</code>
      button:
    </p>

    <img src="248a63f1aed562d9.gif"/>

    <p>
      We can now fill the new fields that appeared:
    </p>
    <ul>
      <li>the hostname or IP address of the host</li>
      <li>the login</li>
      <li>the password, we can also keep this field void. In that case password will be asked once when needed</li>
      <li>
	We will also be sure the box
	<code>Check remote hosts from the known-host file</code>
	is checked, this is important for security
      </li>
      <li>
	and we let the rest as is.
      </li>
    </ul>

    <p>
      Of course we click the <code>Apply changes</code> to
      send the information to Webdar:
    </p>

    <img src="9d4d88f0857a3a8f.gif"/>

    <p>
      If the configuration is now know by Webdar after we have clicked
      <code>Apply changed</code> It has not yet received a name nor is
      saved, let's do that in the bottom form where shows the red warning
      to make it vanishing:
    </p>

    <img src="5baafff022d0945d.gif"/>

    <p>
      We seen that the red warning has vanished, but also a new item in
      the configuration list on the right, and the one which is selected is
      that one, we just created.
    </p>

    <p>
      In the configuration above, we have provided a password. It is
      possible not to provide credential for authentication here. The
      consequence is that during the operation (backup for example) dar
      will interactively ask you to give the password to access the SFTP
      server. This is a matter of choice.
    </p>

    <p>
      Well, now the configuration is done and saved, but it is not yet used
      anywhere. To fix that, we could make use
      of an <em>on-fly</em> configuration derived from the <code>default</code>
      restore operation in which we would have changed the repository from
      <code>default</code> (remember nested configuration?) to our
      new named <code>dar-check on Jupiter</code>configuration.
    </p>

    <p>
      Be we will do else for the demo. As our plan is to proceed to
      a restoration, We will modify the named <code>default</code> restoration operation.
      Let's open the Restore Options (the last tab):
    </p>

    <img src="30eb40d1101b9f1d.gif"/>

    <p>
      What that!? There is no repository options???
    </p>
    <p>
      Yes! This is because the restoration is performed in two steps:
    </p>
    <ul>
	<li>First loading and reading the backup</li>
	<li>Then proceed to the restoration itself</li>
    </ul>

    <p
      >So we have rather to edit named <code>default</code>
      option of the <code>Read Options</code> tab:
    </p>

    <img src="afe62f0d8e212b30.gif"/>

    <p>
      This option set is available for any operation that requires a
      backup to be read:</p>
    <ul>
      <li>testing a backup</li>
      <li>comparing a backup</li>
      <li>listing a backup</li>
      <li>isolating a backup</li>
      <li>merging backups</li>
      <li>repairing backups</li>
      <li>restoring backups</li>
      <li>but also creating a differential, incremental or even
	decremental backup, as there is a backup of reference to read
      </li>
    </ul>

    <p>
      As usual now, we select the <code>default</code> configuration, click the
      <code>Load selected</code> button and open the <code>Backup Location</code>
      inside the configuration form:
    </p>

    <img src="2433506ede3dda91.gif"/>

    <p>
      We see here that the backup location refers to the named <code>default</code>
      repository. We just have to replace it by the SFTP configuration we have
      created previously:
    </p>

    <img src="4553a1d5e1d9c01e.gif"/>

    <p>
      Once done have to send the change to Webdar clicking the <code>update</code> button
      and then the <code>Save/Save as</code> for the red warning to vanish:
    </p>

    <img src="b5ce952caba96469.gif"/>

    <h3>min-digits option</h3>

    <p>
      We mentioned the min-digits when performing the testing operation
      earlier in this tutorial. You will find this option in the
      <code>Reading options</code> here. This is where we should have to
      set or modify it if we entered manually the path + basename of an archive
      to read without the help of the '+' button and
      navigation popup it triggers. There is an equivalent <em>min-digits</em>
      field for the <code>Create options</code>, <code>Merge options</code> and
      <code>Isolate options</code>.
    </p>

    <img src="868ddb89af500c2e.gif"/>

    <p>
      OK, we are good to go to jump to the <code>Restore</code> of the left handed menu:
    </p>

    <h3>Illustration with restoration operation</h3>

    <img src="2569808a318b0d62.gif"/>

    <p>
      As we can see, the <code>Backup Path</code> is already filled with
      what we specified as <em>landing path</em>, so we just have to click the <code>+</code>
      button on the right:
    </p>

    <center>
      <img src="ea8e9b9d8d98827c.gif"/>
    </center>

    <p>
      It will set the min-digits accordingly to the backup we will
      select:
    </p>

    <img src="9903f9afebf91d7f.gif"/>

    <p>
      We can see the backup that was stored on the USB key (I have
      transferred it from there to the SFTP server. Of course, I let you
      link the dots and imagine we have used this same SFTP repository at
      backup time). Let's select the <code>full1.001.dar</code> slice and click the
      <code>Select</code> Button.
    </p>

    <img src="4a5e6a24d09ea1a1.gif"/>

    <p>
      Doing that way the min-digits has been set to 3, and we see also
      the expected <code>Backup path</code> in the remote SFTP repository
      updated with the basename of the backup.
    </p>

    <p>
      Restoring the whole backup is simple, just click the <code>Restore</code>
      Button.
    </p>

    <h3>Using the <em>in-place path</em></h3>

    <p>
      Here the target is explicitly <code>/home/denis</code> which was the
      root path used at backup time. We can decide to restore elsewhere of
      course. We can also leverage
      the <em>in-place path</em> that has been stored in the backup:
    </p>

    <p>
      For that we have to edit the <code>Restoration Options</code> as we
      did for other configuration category earlier in this tutorial, then
      check the first checkbox
      <code>Ignore the provided root directory above and use instead the in-place directory</code>:
    </p>

    <img src="f17c52379374204c.gif"/>

    <p>
      Of course, as next step we will click the <code>Update</code>
      button. But it is not necessary to fill a name and click the <code>Save As</code>
      button, here we use an <em>on-fly</em> configuration. If you click back on the
      <code>Restoration Parameters</code> tab, you will see a warning
      showing about the in-place path being used:
    </p>

    <img src="dc7d8cb9c1b9a21c.gif"/>

    <p>
      So you guess the next step is to press the <code>Restore</code> button
      on the right bottom of the page to proceed to the full restoration
    </p>

    <h3>Restoring only some file</h3>

    <p>
      But what if instead of restoring the whole backup we would like
      to restore only a single file and moreover having it restored in
      a given directory without all the sub-directories leading to it?
    </p>

    <p>
      For that:
    </p>
    <ul>
      <li>
	<p>
	We will remove the in-place
	option we just used for the previous demo,
	</p>
      </li>
      <li>
	<p>
	  We will Add a <code>Path base filtering</code> for that file only (this file path + name is
	  <code>Documents/Genealogie/Enregistrement_Centenaire/transcription_centenaire.rtf</code>)
	</p>
	<img src="298a7239776ccfc8.gif"/>
      </li>
      <li>
	<p>
	  As there will be a lot of file *not* restored we will disable
	  the display of skipped file to focus on what is restored:
	</p>
	<img src="f062a4469a3cfb93.gif"/>
      </li>
      <li>
	<p>
	  And last, we will unset the restoration of the directory structure
	</p>
	<img src="82a3f0f20fda1730.gif"/>
      </li>
    </ul>

    <p>
      We will also change the target directory where to restore this
      file to <code>/tmp</code> (<em>This is probably not a good place to restore personal data, but this is a demo</em>).
    </p>

    <img src="5e1fcbe453db8587.gif"/>

    <p>
      We can now click the bottom right <code>Restore</code> Button to proceed:
    </p>

    <img src="a99931b99682f290.gif"/>

    <p>
      Yes, the backup is ciphered... so we enter the password of the backup. Note that if we
      had not set a the authentication credentials in the SFTP configuration we save in Webdar
      before that password, Webdar would have asked for the password to authenticate to the
      server, at least the first time we open the SFTP server.
    </p>

    <img src="5a344dfd454d2c43.gif"/>

    <p>
      The counter at the bottom of the page show one file restored, as
      expected, and from the log above we can see the file's data being
      restored. Though its Extended Attributes (which here are related to NFS v4
      as the file was stored on the filesystem at backup time) are not
      supported on the local filesystem in <code>/tmp</code> which is an ext4 filesystem.
    </p>

    <p>
      Though we can compare with diff that the file is identical to the
      one that has been saved:
    </p>

    <code clas=block>
 &gt; diff -s /tmp/transcription_centenaire.rtf /home/denis/Documents/Genealogie/Enregistrement_Centenaire/transcription_centenaire.rtf
Files /tmp/transcription_centenaire.rtf and /home/denis/Documents/Genealogie/Enregistrement_Centenaire/transcription_centenaire.rtf
are identical
 &gt;
    </code>

    <a id="h2F"><h2>Network and Application security</h2></a>

    <p>
      Webdar can be used completely locally to a given computer, this is even the default:
      the browser runs on the same node as Webdar and connect through the loopback interface
      (127.0.0.1 or ::1) and the backup are stored locally (USB key, disk...).
    </p>

    <p>
      But when it comes to make distributed functioning, where the browser sits on one node,
      different from the one where Webdar is running and the data stored on the third different
      node or NAS, there are two things to consider:
    </p>

    <h3>Browser - Webdar communication</h3>

    <p>
      If the underlying network in unsecured (public Wifi, Internet, corporate network you don't trust ...)
      the HTTP protocol is not enough. Where from the HTTPS (Secured HTTP).
    </p>

    <p>
      HTTPS is broadly used and establish the trust between the browser and the web server (here Webdar)
      by mean of an intermediate Certificate Authority (CA) both ends trust. This is known as a PKI for
      Public Key Infrastructure. IT pro know well how to set this up, but for homeland this is overkill.
    </p>

    <p>
      You could use self-signed certificate, this provide ciphering of the data but you are not sure to
      connect to the correct Webdar server, or said in other words you could connect indirectly to the
      server you expect but in the middle some could eavesdrop the communication,
      the so called <em>man-in-the-middle</em> attack (MITM in the following).
    <p>

    <p>
      You can reduce the risk of MITM attack still using a self-signed certificate. This is the objective
      of this chapter:
    </p>

    <p>
      First, create a self signed certificate and compute its fingerprint
    </p>

    <code class=block>
      &gt; openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout mycert.pem -out mycert.pem

      # this creates a 1 year valid certificate stored in the file mycert.pem. As it is self signed
      # the certificate and the key pair to cipher the HTTPS session are enclosed in the same file

      &gt; openssl x509 -in mycert.pem -fingerprint -noout
      SHA1 Fingerprint=93:1A:0A:48:B0:B8:FE:FE:1E:DF:CA:AA:4D:D4:60:AB:45:34:20:06

      # this previous command shows the SHA1 hash of the key/certificate

      &gt; openssl x509 -in mycert.pem -fingerprint -sha256 -noout
      sha256 Fingerprint=BE:15:3E:07:4B:1E:F1:D7:39:A1:99:87:16:F6:2D:8F:C9:9A:1D:D3:26:8A:5C:92:9B:DC:43:01:DC:F6:BA:1A

      # this is here the SHA256 hash that is shown
    </code>

    <p>
      Now we can run Webdar with this certificate and key pair
    </p>

    <code class=block>
      &gt; webdar -l 0.0.0.0 -C mycert.pem -K mycert.pem
      [thead 140401792813632][information]   A new SSL context has been created
      [thead 140401792813632][warning]

        You can now point your browser at:
                https://<hostname or IP>:8008
        and use the following to authenticate:
                user name = admin
                password  =


	[thead 140401783879360][information]   listener object: waiting for incoming connections on 0.0.0.0 port 8008
    </code>

    <p>
      Now when connecting from our web Browser to Webdar, of course we will get a
      warning about this certificate to be unsecured, because it is not certified
      but any CA the browser knows:
    </p>

    <img src="certificate1.jpg"/>

    <p>
      but we can compare the SHA1 and/or SHA256 hash
      (also known as fingerprint) of the certificate received by the browser with
      the one we have computed above. For that, click the <code>Advanced...</code> white button
      (OK my browser, here Firefox, is French localized, but you should find the same
      disposition for other languages):
    </p>

    <img src="certificate2.jpg"/>

    <p>
      Then click on the hyperlink "Display the certificate", see the mouse pointer below:
    </p>

    <img src="certificate3.jpg"/>

    <p>
      Then scroll down the the fingerprint part and compare the SHA1 and/or SHA256 fingerprints
      of the certificate received by the browser with the one we computed on the node where Webdar
      is running:
    </p>

    <img src="certificate4.jpg"/>

    <p>
      If they match as they do here, you are pretty sure your session is secured and you can let you browser
      accepting this certificate. You will not be bothered by your browser until your certificate expires or you change of
      IP/hostname for Webdar, or until someone attempts to intercepts your session with a MITM attack, in which
      case you should not accept the certificate nor connect to Webdar but investigate the root cause of this
      problem and fix this possible security breach. Probably generating a new self-signed certificate and
      comparing the hash will let you "solve" or workaround this issue (?)
    </p>

    <h3>Webdar - SFTP server communication</h3>

    <p>
      FTP is not secured, use SFTP to send or fetch your backups to a remote node.
    </p>

    <p>
      SFTP is a subsystem of SSH and you must that relies on public/private key pair from
      the server authentication and either password or also key pair for user authentication
      by the server.
    </p>

    <p>
      The first time you connect in SSH or SFTP to a server, it will show you server
      key-pair fingerprints and you should not accept them lightly, but rather compare
      them to the one of the server.
    </p>

    <p>
      The SSH/SFTP server fingerprint can be obtained and provided by the server admin running this
      command:
    </p>

    <code class=block>
      for x in /etc/ssh/*.pub ; do ssh-keygen -l -f "$x" ; done
    </code>

    <p>
      As a server usually have several keys of different type, you may have sever fingerprints. If
      one of them matches fingerprint showed when you first connect to that server, you are good to
      accept it and connect to that server. Else there is a security issue and you put at risk you
      data.
    </p>
</body>
</html>
